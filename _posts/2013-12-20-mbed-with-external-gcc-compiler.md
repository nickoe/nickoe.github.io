---
layout: post
tags: gcc computing embedded
---

This is a small note on how to use a [mbed.org] project and build it
locally with gcc.

If you get the error

	arm-none-eabi-gcc: error: nano.specs: No such file or directory

this most likely means that you have not installed the [newlib-nano].
To still be able to compile with just the [newlib], then you can just
remove the `--specs=nano.specs` from the `LD_FLAGS` variable in the
`Makefile` generated by [mbed.org]. Now back to work!

## Making programming easier

Since this mbed platform tries to make everything fast and simple by
allowing you to access it as a mass storage medium, then it kind of
gets hard to make it actually load the new program.

There is several ways to do this as explained on the [mbed forum]. We
can use this information to modify the `Makefile` suck it will install
it for us and reset the target, using the trick of sending the break
signal. There is a four second delay after the bin has been written,
this seems to be required to make a safe reset. See below snippet.

{% include pathorcmd.html param="Makefile" %}
	install: $(PROJECT).bin
		@echo "Clearing $(PROJECT).bin on target"
		@rm -f /run/media/`whoami`/MBED/*.bin
		@cp $(PROJECT).bin /run/media/`whoami`/MBED/
		@echo "Copying should be done now"
		@echo -n "Sleeping such that the lazy liquorice is ready"
		@sleep 1;echo -n ".";sleep 1;echo -n ".";sleep 1;echo ".";sleep 1 
		@echo "Resetting target"
		@./sendbreak.py

It requires a lille python script to send the magic break. Listed
below, which of course requires [pyserial].

{% include pathorcmd.html param="sendbreak.py" %}
	#!/usr/bin/env python
	import serial
	
	ser  = serial.Serial('/dev/ttyACM0', 115200, timeout=1)
	ser.sendBreak()
	ser.close()

[mbed.org]: http://mbed.org
[newlib-nano]: https://github.com/32bitmicro/newlib-nano-1.0
[newlib]: https://sourceware.org/newlib/
[mbed forum]: http://mbed.org/forum/mbed/topic/890/?page=1#comment-4327
[pyserial]: http://pyserial.sourceforge.net/
